import{u as $,r as b,W as P,j as e,q as _,Y,b as I,y as H,c as L}from"./app-afdbe2b2.js";import{B as R,S as V}from"./index-9b95e8d2.js";import{C as W,a as G,b as J,c as M,d as K,e as Q}from"./index-d9d43a13.js";import{F as U}from"./index-f5dd8962.js";import{i as X,j as B,d as Z,t as D}from"./index.esm-788f3b02.js";import{b as k,A as ee,H as ae,T as se,B as le}from"./AuthLayout-ecdf685d.js";import{a as te}from"./dataSelect-51f2092f.js";import{d as g,e as n,u as q}from"./mask-c14164de.js";import{h as oe}from"./moment-a9aaa855.js";const re=({produtos:l})=>{const{showModalParts:S,setShowModalParts:N,sendOrderParts:u,setSendOrderParts:p}=$(),[r,v]=b.useState([]),[o,y]=b.useState([]),{data:f,setData:C}=P({pecas:"",quantidade:"",valor:""}),d=t=>{const i=t.toLowerCase(),j=l.filter(m=>m.descricao.toLowerCase().includes(i));v(j)};b.useEffect(()=>{f.pecas===""&&v([])},[f]);const w=(t,i,j)=>{let m={id:t,descricao:i,valvenda:j};y([...o,m]),C(F=>({...F,pecas:""})),v([])},h=t=>{const i=o.filter((j,m)=>m!==t);y(i)},s=()=>{p(o),N(!1)};return e.jsx(e.Fragment,{children:S&&e.jsx("div",{className:"fixed top-0 right-0 bottom-0 left-0 flex items-center justify-center bg-gray-800/90 z-40",children:e.jsxs("div",{className:"w-full sm:max-w-md mx-4 bg-gradient-to-t from-gray-300 via-white to-gray-200 shadow-md overflow-hidden rounded-md border border-white text-gray-600",children:[e.jsxs("div",{className:"h-8 flex items-center justify-between border-b px-2 bg-blue-cinco text-white rounded-t-lg",children:[e.jsx(k,{size:18}),e.jsx("h1",{className:"ml-2 flex-1 text-sm font-semibold",children:"Adicione peças/produtos a ordem"}),e.jsx("div",{className:"cursor-pointer",children:e.jsx(X,{size:20,onClick:()=>N(!1)})})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex flex-col col-span-2 relative",children:[e.jsx("label",{className:"label-form",htmlFor:"pecas",children:"Buscar Peça"}),e.jsx("input",{id:"pecas",type:"text",value:f.pecas,onChange:t=>{C("pecas",t.target.value),d(t.target.value)},className:"input-form"}),r.length>0&&e.jsx("div",{className:"absolute bg-gray-50 border-2 border-white shadow-md w-full rounded-sm top-16 max-h-52 overflow-y-auto",children:e.jsx("ul",{className:"p-1",children:r.map((t,i)=>e.jsx("li",{className:`flex items-center justify-normal ${i<r.length-1?"border-b border-gray-200":""}`,children:e.jsx("div",{className:"text-sm text-gray-600 p-1 cursor-pointer inline-block w-full",onClick:()=>w(t.id,t.descricao,t.valvenda),children:t.descricao})},i))})})]}),o.length>0&&e.jsx("div",{className:"mt-4 p-2 border border-gray-300 rounded-md",children:o.map((t,i)=>e.jsxs("div",{className:`py-1 grid grid-cols-4 ${o.length-1==i?"":"border-b border-b-gray-300"}`,children:[e.jsx("div",{children:t.descricao}),e.jsx("div",{children:t.valvenda}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:()=>h(i),className:"bg-red-500 rounded text-white p-1",children:e.jsx(B,{})})})]},i))}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs("button",{onClick:s,className:"flex items-center justify-center gap-2 bg-blue-700 hover:bg-blue-600 py-1.5 px-3 rounded-md shadow text-gray-50 self-end",children:[e.jsx(k,{size:18}),e.jsx("span",{children:"Inserir peças"})]})})]})]})})})},fe=({ordens:l,tecnicos:S,produtos:N,ordemProduto:u,currentPage:p,gerais:r})=>{var O,z;const{setShowModalParts:v,sendOrderParts:o,setSendOrderParts:y}=$(),f=r!=null&&r.equtipo?(O=r==null?void 0:r.equtipo)==null?void 0:O.split(";"):[];r!=null&&r.equestado&&((z=r==null?void 0:r.equestado)==null||z.split(";"));const{flash:C,errors:d,ziggy:w}=_().props,{oc:h}=w.query;o.length>0;const{data:s,setData:t,progress:i,processing:j}=P({id:l.id,equipamento:l.equipamento,modelo:l.modelo,senha:l.senha,defeito:l.defeito,estado:l.estado,acessorios:l.acessorios,previsao:l.previsao,descorcamento:l.descorcamento,valorcamento:l.valorcamento?l.valorcamento:"0",pecas:l.pecas,valpecas:l.valpecas?l.valpecas:"0",valservico:l.valservico?l.valservico:"0",custo:l.custo?l.custo:"0",status:l.status,tecnico:l.tecnico,detalhes:l.detalhes,obs:l.obs,page:p});async function m(a){a.preventDefault(),H.post(`/ordens/${l.id}${h?"?oc="+h:""}`,{_method:"patch",id:s.id,equipamento:s.equipamento,modelo:s.modelo,senha:s.senha,defeito:s.defeito,estado:s.estado,acessorios:s.acessorios,previsao:s.previsao,descorcamento:s.descorcamento,valorcamento:n(s.valorcamento.toString()),pecas:s.pecas,produtos:o.map(c=>c.pecaid),valpecas:n(s.valpecas.toString()),valservico:n(s.valservico.toString()),custo:n(s.custo.toString()),status:s.status,dtentrega:l.dtentrega?l.dtentrega:null,dtfeedback:l.dtentrega?oe(l.dtentrega).add(30,"days").format("DD/MM/YYYY"):null,tecnico:s.tecnico,detalhes:s.detalhes,obs:s.obs,page:p}),await L.post("insert-order",{orders:[{id:s.id,cliente_id:l.cliente_id,detalhes:s.detalhes,defeito:s.defeito,descorcamento:s.descorcamento,valorcamento:n(s.valorcamento.toString()),valservico:n(s.valservico.toString()),custo:n(s.custo.toString()),valpecas:n(s.valpecas.toString()),created_at:l.created_at,dtentrega:l.dtentrega,status:s.status}]}).then(c=>{console.log(c.data.response.message)}).catch(c=>{console.log(c)})}b.useEffect(()=>{(()=>{if(o.length>0){let c=(o.length>0?o:u).map(x=>parseFloat(x.valvenda)).reduce((x,A,ce)=>x+A);t(x=>({...x,valpecas:c}))}})()},[o]);const F=(a,c,x)=>parseInt(q(a))+parseInt(q(c))+parseInt(q(x)),{get:E}=P(),T=()=>{o.length>0?y([]):E(route("delpecaordem",l.id)),t(a=>({...a,valpecas:"0"}))};return b.useEffect(()=>{const a=F(s.valorcamento.toString(),s.valpecas.toString(),s.valservico.toString());t(c=>({...c,custo:a}))},[s]),e.jsxs(e.Fragment,{children:[e.jsx(re,{produtos:N}),e.jsxs(ee,{children:[e.jsx(Y,{title:"Ordens"}),e.jsxs(W,{children:[e.jsxs(ae,{children:[e.jsxs(se,{children:[e.jsx(Z,{size:30}),e.jsx("span",{className:"ml-2",children:"Ordens"})]}),e.jsx(le,{links:[{url:"/ordens",label:"Ordens"},{url:null,label:"Adicionar ordem"}]})]}),e.jsxs(G,{children:[e.jsx(U,{message:C}),e.jsxs(J,{children:[e.jsx(M,{children:e.jsx(R,{url:`/ordens?page=${p}${h?"&oc="+h:""}`,label:"Voltar"})}),e.jsx(M,{children:e.jsx(e.Fragment,{})})]}),e.jsxs("form",{onSubmit:m,autoComplete:"off",children:[e.jsx(K,{className:" border-y border-gray-100",children:e.jsxs("div",{className:"px-3 my-4",children:[e.jsxs("div",{className:"grid grid-cols-5 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"label-form",htmlFor:"ordem",children:"Ordem"}),e.jsx("input",{id:"ordem",type:"text",value:s.id,className:"input-form",disabled:!0})]}),e.jsxs("div",{className:"flex flex-col col-span-2",children:[e.jsx("label",{className:"label-form",htmlFor:"cliente_id",children:"Nome do cliente"}),e.jsx("input",{id:"equipamento",type:"text",value:l.cliente.nome,className:"input-form",disabled:!0})]}),e.jsxs("div",{className:"flex flex-col col-span-2",children:[e.jsx("label",{className:"label-form",htmlFor:"equipamento",children:"Tipo de equipamento"}),e.jsxs("select",{id:"equipamento",value:s.equipamento,onChange:a=>t("equipamento",a.target.value),className:"input-form",children:[e.jsx("option",{value:"",children:"Selecione o tipo de equipamento"}),f.map((a,c)=>e.jsx("option",{value:a.trim(),children:a},c))]}),d.equipamento&&e.jsx("div",{className:"text-red-500",children:d.equipamento})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"flex flex-col col-span-2",children:[e.jsx("label",{className:"label-form",htmlFor:"modelo",children:"Modelo do equipamento"}),e.jsx("input",{id:"modelo",type:"text",value:s.modelo,onChange:a=>t("modelo",a.target.value),className:"input-form"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"label-form",htmlFor:"senha",children:"Senha do equipamento"}),e.jsx("input",{id:"senha",type:"text",value:s.senha,onChange:a=>t("senha",a.target.value),className:"input-form"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"label-form",htmlFor:"previsao",children:"Previsão de entrega"}),e.jsx("input",{id:"previsao",type:"date",value:s.previsao,onChange:a=>t("previsao",a.target.value),className:"input-form"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"label-form",htmlFor:"defeito",children:"Defeito relatado/Serviço solicitado"}),e.jsx("textarea",{id:"defeito",value:s.defeito,onChange:a=>t("defeito",a.target.value),className:"input-form"}),d.defeito&&e.jsx("div",{className:"text-sm text-red-500",children:d.defeito})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"label-form",htmlFor:"estado",children:"Estado do equipamento"}),e.jsx("textarea",{id:"estado",value:s.estado,onChange:a=>t("estado",a.target.value),className:"input-form"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"label-form",htmlFor:"acessorios",children:"Acessórios"}),e.jsx("textarea",{id:"acessorios",value:s.acessorios,onChange:a=>t("acessorios",a.target.value),className:"input-form"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6 px-2 py-4 bg-gray-50 rounded-md border",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"label-form",htmlFor:"valorcamento",children:"Valor orçamento"}),e.jsx("input",{id:"valorcamento",type:"text",value:g(s.valorcamento.toString()),onChange:a=>t("valorcamento",a.target.value),className:"input-form"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"label-form",htmlFor:"descorcamento",children:"Descrição do orçamento"}),e.jsx("textarea",{id:"descorcamento",value:s.descorcamento,onChange:a=>t("descorcamento",a.target.value),className:"input-form"})]})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-4 mt-6",children:[e.jsxs("div",{className:"flex flex-col col-span-2",children:[e.jsx("label",{className:"label-form",htmlFor:"pecas",children:"Peças utilizadas (manual)"}),e.jsx("div",{className:"flex items-center justify-start gap-4 w-full",children:e.jsx("textarea",{id:"pecas",value:s.pecas,onChange:a=>t("pecas",a.target.value),className:"input-form !h-20 w-full"})})]}),e.jsxs("div",{className:"flex flex-col col-span-2",children:[e.jsx("label",{className:"label-form",htmlFor:"pecas",children:"Peças utilizadas (estoque)"}),e.jsx("div",{className:"flex items-center justify-start gap-4 w-full",children:e.jsxs("div",{className:"flex items-start justify-start w-full",children:[e.jsx("div",{className:"h-20 input-form !rounded-r-none overflow-y-auto w-full",children:(o.length>0?o:u).map((a,c)=>e.jsxs("div",{className:`py-1 flex justify-between ${(o.length>0?o:u).length-1==c?"":"border-b border-b-gray-300"}`,children:[e.jsx("div",{children:a.descricao}),e.jsx("div",{children:g(a.valvenda)})]},c))}),e.jsxs("div",{children:[e.jsx("button",{title:"Inserir peças",type:"button",className:"bg-blue-600 hover:bg-blue-600/90 py-2.5 px-3  shadow text-gray-50 h-10 rounded-tr-md",onClick:()=>v(!0),children:e.jsx(k,{size:22})}),e.jsx("button",{title:"Limpa peças",type:"button",onClick:T,className:"bg-red-600 hover:bg-red-600/90 py-2.5 px-3 shadow text-gray-50 h-10 rounded-br-md",children:e.jsx(B,{size:22})})]})]})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"label-form",htmlFor:"valpecas",children:"Valor das peças"}),e.jsx("input",{id:"valpecas",type:"text",value:g(s.valpecas.toString()),onChange:a=>t("valpecas",a.target.value),className:"input-form"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"label-form",htmlFor:"valservico",children:"Valor do serviço"}),e.jsx("input",{id:"valservico",type:"text",value:g(s.valservico.toString()),onChange:a=>t("valservico",a.target.value),className:"input-form"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"label-form",htmlFor:"custo",children:"Custo total"}),e.jsx("input",{id:"custo",type:"text",value:g(s.custo.toString()),onChange:a=>t("custo",a.target.value),className:"input-form",readOnly:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"label-form",htmlFor:"tecnico",children:"Técnico"}),e.jsxs("select",{id:"tecnico",value:s.tecnico,onChange:a=>t("tecnico",a.target.value),className:"input-form",children:[e.jsx("option",{value:"",children:"Selecione o técnico"}),S.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),d.tecnico&&e.jsx("div",{className:"text-sm text-red-500",children:d.tecnico})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"label-form",htmlFor:"status",children:"Status do serviço"}),e.jsxs("select",{id:"status",value:s.status,onChange:a=>t("status",a.target.value),className:"input-form",children:[e.jsx("option",{value:"",children:"Selecione o status"}),te.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"label-form",htmlFor:"detalhes",children:"Detalhes do serviço"}),e.jsx("textarea",{id:"detalhes",value:s.detalhes,onChange:a=>t("detalhes",a.target.value),className:"input-form"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"label-form",htmlFor:"obs",children:"Observações"}),e.jsx("textarea",{id:"obs",value:s.obs,onChange:a=>t("obs",a.target.value),className:"input-form"})]})]})]})}),e.jsx(Q,{children:e.jsxs("div",{className:"flex items-center justify-end gap-4",children:[l.status===8&&e.jsxs(e.Fragment,{children:[e.jsxs(I,{disabled:l.status!="8",as:"button",href:`/docs/printer?or=${l.id}&tp=2`,className:"flex items-center justify-center bg-teal-700 hover:bg-teal-700/90 py-1.5 px-3 rounded-md shadow text-gray-50 self-end transition-colors duration-300",children:[e.jsx(D,{size:18}),e.jsx("span",{className:"ml-2",children:"Recibo de entrega"})]}),e.jsxs(I,{disabled:l.status!="8",as:"button",href:`/docs/printer?or=${l.id}&tp=4`,className:"flex items-center justify-center bg-teal-700 hover:bg-teal-700/90 py-1.5 px-3 rounded-md shadow text-gray-50 self-end transition-colors duration-300",children:[e.jsx(D,{size:18}),e.jsx("span",{className:"ml-2",children:"Checklist de entrega"})]})]}),e.jsx(V,{})]})})]})]})]})]})]})};export{fe as default};
